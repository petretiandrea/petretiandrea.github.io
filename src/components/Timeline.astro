---
import type { Experience } from '../data/experiences';
import { getLangFromUrl, useTranslations } from '../i18n/locales';
import { Icon } from 'astro-icon/components';

interface Props {
  experiences: Experience[];
}

const { experiences } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

function formatDate(dateStr: string) {
  if (!dateStr) return '';
  const date = new Date(dateStr);
  const month = date.toLocaleDateString(lang, { month: 'long' });
  const year = date.getFullYear();
  const formatted = `${month} ${year}`;
  return formatted.charAt(0).toUpperCase() + formatted.slice(1);
}
---

<div class="opacity-100 mt-10">
  <ol class="relative border-l border-gray-200 dark:border-gray-700">
    {experiences.map((experience) => (
      <li class="mb-10 ml-6">
        <span
          class={`flex absolute -left-3 justify-center items-center w-6 h-6 rounded-full ring-8 ring-white dark:ring-gray-900 bg-${experience.color}-500`}
        >
          <Icon name={experience.icon} class="w-3 h-3 text-white" />
        </span>
        <h3
          class={`flex items-center mb-1 text-lg font-semibold dark:text-white text-${experience.color}-500`}
        >
          {experience.title}
          {experience.currently && (
            <span class="bg-blue-100 text-blue-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800 ml-3">
              {t('actual_job_label')}
            </span>
          )}
        </h3>
        <time class="block mb-2 text-sm font-normal leading-none text-gray-400 dark:text-gray-500">
          {formatDate(experience.from)}
        </time>
        <p class="mb-4 text-base font-normal text-gray-500 dark:text-gray-400 whitespace-pre-line">
          {experience.description}
        </p>
      </li>
    ))}
  </ol>
</div>
